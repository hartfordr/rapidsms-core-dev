{% extends "locations/base.html" %}
{% load forms_tags %}
{% load djtables_tags %}

{% block stylesheets %}
{{ block.super }}
<link type="text/css" rel="stylesheet" href="{{ MEDIA_URL }}locations/stylesheets/locations.css" />
<link type="text/css" rel="stylesheet" href="{{ MEDIA_URL }}locations/stylesheets/label-overlay.css" />
{% endblock %}

{% block javascripts %}
{{ block.super }}
<script type="text/javascript" src="http://maps.google.com/maps/api/js?sensor=false"></script>
<script src="{{ MEDIA_URL }}locations/javascripts/label-overlay.js" type="text/javascript"></script>
<script src="{{ MEDIA_URL }}locations/javascripts/map.js" type="text/javascript"></script>
{% endblock %}

{% block content %}
	<h3>{% for title, href in breadcrumbs %}{% if not forloop.first %} &raquo; {% endif %}<a href="{{href}}">{{ title }}</a>{% endfor %}</h3>
{{ block.super }}
{% endblock %}

{% block left %}{% if no_location_types %}
<div class="module tables">
	<table>
		<tbody>
		<tr class="no-data error">
			<td>
				<p>
					You haven't created any subclasses of Location yet.
				</p>
			</td>
			</tr>
		</tbody>
	</table>
</div>{% else %}{% for type in location_types %}{% if not type.is_empty %}
<div class="module tables{% if type.is_empty %} collapsed{% endif %}">
	<h2>{{ type.plural|title }}</h2>
	<table class="locations">
		{% table_cols type.table %}
		{% table_head type.table %}

		<tbody>{% for location in type.table.rows %}
			<tr>
				<th scope="row"><a href="{% url locations location.uid %}">{{ location }}</a></th>
			</tr>{% empty %}
			<tr class="no-data">
				<td colspan="{{ num_columns }}">
					<p>
						Nothing to display.
					</p>
				</td>
			</tr>{% endfor %}
		</tbody>

		{% table_foot type.table %}
	</table>
</div>{% endif %}{% endfor %}{% endif %}
{% endblock %}

{% block middle %}
<div class="module">
	<h2>Map</h2>
	<div class="map" lat="{{ default_latitude }}" lng="{{ default_longitude }}">
		<div class="container"></div>

		<ul class="labels">{% for type in location_types %}{% for location in type.locations %}
			<li facility_link="/facilities/{{ location.service_delivery_point.id }}/months_of_stock/"
				lat="{{ location.point.latitude }}" 
				lng="{{ location.point.longitude }}" 
				name="{{ location.name }}" 
				inj="{{ location.service_delivery_point.stock_on_hand_inj }}"
				coc="{{ location.service_delivery_point.stock_on_hand_coc }}"
				pop="{{ location.service_delivery_point.stock_on_hand_pop }}"
				iud="{{ location.service_delivery_point.stock_on_hand_iud }}"
				imp="{{ location.service_delivery_point.stock_on_hand_imp }}"
				con="{{ location.service_delivery_point.stock_on_hand_con }}"
				msd_code="{{ location.service_delivery_point.msd_code }}"
			{% if location.service_delivery_point.randr_status %}
				randr_status="{{ location.service_delivery_point.randr_status }}: {{ location.service_delivery_point.randr_status.status_date }}"
			{% else %}
				randr_status="No status reported"
			{% endif %}			
				last_reported="{{ location.service_delivery_point.stock_on_hand_last_reported }}">
				{{ location.InfoWindowHTML }}
			</li>{% endfor %}{% endfor %}
		</ul>
	</div>
	<div class="toolbar">
		<a class="maximize">Maximize</a>
	</div>
</div>
{% endblock %}